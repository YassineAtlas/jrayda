<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Espace famille</title>
  <link rel="stylesheet" href="style.css?v=20260221-14">
</head>
<body>
  <header class="site-header">
    <div class="site-nav">
      <h1><a href="index.html">Mes plantes</a></h1>
      <a class="family-link family-link-active" href="famille.html">Espace famille</a>
    </div>
  </header>

  <main class="family-container">
    <section class="panel" id="auth-panel">
      <h2>Connexion famille</h2>
      <p>Connecte-toi avec ton mot de passe. Pour la premiere connexion, utilise le lien email.</p>

      <form id="password-login-form">
        <label for="password-email">Email</label>
        <input type="email" id="password-email" required placeholder="prenom@exemple.com">

        <label for="password-login-input">Mot de passe</label>
        <input type="password" id="password-login-input" required minlength="8" placeholder="Ton mot de passe">

        <button type="submit">Se connecter</button>
      </form>

      <p class="auth-separator">ou</p>

      <form id="magic-link-form">
        <label for="magic-email">Premiere connexion / mot de passe oublie</label>
        <input type="email" id="magic-email" required placeholder="prenom@exemple.com">
        <button type="submit">Recevoir un lien par email</button>
      </form>

      <p id="auth-message" class="status-message"></p>
    </section>

    <section class="panel hidden" id="member-panel" hidden>
      <div class="member-header">
        <h2>Mes semis</h2>
        <div class="member-actions">
          <button id="open-password-btn" type="button" class="secondary">Changer le mot de passe</button>
          <button id="logout-btn" type="button">Se deconnecter</button>
        </div>
      </div>

      <div id="seed-workspace">
        <form id="seed-form" class="seed-form">
          <input type="hidden" id="seed-id">

          <label for="plant-select">Plante</label>
          <select id="plant-select" required>
            <option value="">Choisir une plante</option>
          </select>

          <label for="seed-date">Date de semis</label>
          <input type="date" id="seed-date" required>

          <label for="current-week">Semaine actuelle du semis (automatique)</label>
          <input type="number" id="current-week" min="1" step="1" value="1" readonly>

          <label for="seed-location">Emplacement</label>
          <input type="text" id="seed-location" required placeholder="Serre, balcon, potager...">

          <label for="seed-photo">Photo depuis fichiers (optionnel)</label>
          <input type="file" id="seed-photo" accept="image/*">

          <label for="seed-photo-camera" class="camera-trigger mobile-camera-only">Prendre une photo</label>
          <input type="file" id="seed-photo-camera" class="camera-input-hidden mobile-camera-only" accept="image/*" capture="environment">
          <p id="seed-photo-selected" class="file-selection-indicator">Aucune photo selectionnee.</p>

          <button type="submit" id="save-btn">Ajouter le semis</button>
          <button type="button" id="cancel-edit-btn" class="secondary hidden" hidden>Annuler la modification</button>
        </form>

        <div id="seed-progress" class="seed-progress hidden" hidden aria-live="polite">
          <div class="seed-progress-head">
            <span id="seed-progress-label">Enregistrement...</span>
            <span id="seed-progress-percent">0%</span>
          </div>
          <progress id="seed-progress-bar" max="100" value="0">0%</progress>
        </div>

        <p id="seed-message" class="status-message"></p>
        <div id="seed-list" class="seed-list"></div>
      </div>

      <div id="password-workspace" class="hidden" hidden>
        <form id="password-set-form" class="password-form">
          <h3>Mot de passe du compte</h3>

          <label for="new-password">Nouveau mot de passe</label>
          <input type="password" id="new-password" minlength="8" placeholder="Minimum 8 caracteres" required>

          <label for="confirm-password">Confirmer le mot de passe</label>
          <input type="password" id="confirm-password" minlength="8" placeholder="Retape le mot de passe" required>

          <button type="submit">Enregistrer mon mot de passe</button>
          <button id="close-password-btn" type="button" class="secondary">Retour aux semis</button>
          <p id="password-message" class="status-message"></p>
        </form>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-config.js?v=20260221-6"></script>
  <script src="famille.js?v=20260221-13"></script>
</body>
</html>
